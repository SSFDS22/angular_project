<refresh-count name="LIST"></refresh-count>
<div class="card custom-card">
  <div class="card-body p-4">

    <!--  Form to add new todo-->
    <!--  Form to add new todo-->

    <div class="d-flex align-items-center mb-4">

      <!-- toggle all todos to completed -->
      <input (click)="onToggleAll($any($event.target).checked )"
             [formControl]="inputToggleAllFormControl"
             class="me-3 form-check-input toggle-all-checkbox"
             data-test="toggle-all-checkbox"
             ngbTooltip="Toggle All Todos"
             type="checkbox">
      <!-- toggle all todos to completed-->

      <!-- Filtering Action button -->
      <button (click)="setTasksFilterStatus(TODO_FILTER_ENUM.ALL)"
              [class.myactive]="isFilterStatus(TODO_FILTER_ENUM.ALL)"
              class="m-1 custom-button pipo"
              data-test="filter-button-all">All
      </button>
      <button (click)="setTasksFilterStatus(TODO_FILTER_ENUM.ACTIVE)"
              [class.myactive]="isFilterStatus(TODO_FILTER_ENUM.ACTIVE)"
              class="m-1 custom-button"
              data-test="filter-button-active">Active
      </button>
      <button (click)="setTasksFilterStatus(TODO_FILTER_ENUM.COMPLETED)"
              [class.myactive]="isFilterStatus(TODO_FILTER_ENUM.COMPLETED)"
              class="m-1 custom-button"
              data-test="filter-button-completed">Completed
      </button>
    </div>

    <!-- List content -->
    <div class="list-content">
      <ul class="list-group mb-0">
        <li *ngFor="let todo of (todos | todosFilterPipe:filterChoice); index as idx"
            [ngClass]="{ 'line-through': todo.completed}"
            class="custom-li"
            data-test="todo-item-li">

          <ng-container *ngIf="editingTodo?.id!==todo.id; then thenShow else elseEditing"></ng-container>

          <!-- SHOW mode template -->
          <ng-template #thenShow>
            <ng-container>
              <div class="d-flex align-items-center flex-grow-1">
                <input (change)="onToggleOne(todo)"
                       [checked]="todo.completed"
                       [id]="'todo'+ idx"
                       class="form-check-input me-2"
                       data-test="todo-item-checkbox"
                       type="checkbox">
                <label [for]="'todo'+ idx"
                       data-test="todo-item-label">{{ todo.label }}</label>
              </div>
              <button (click)="onEditTodo(todo)" *ngIf="!todo.completed"
                      class="btn btn-sm"
                      data-test="edit-todo">
                <fa-icon [icon]="faEdit"></fa-icon>
              </button>
              <button (click)="onRemoveTodo(todo)" class="btn btn-sm"
                      data-test="remove-todo">
                <fa-icon [icon]="faRemove"></fa-icon>
              </button>
            </ng-container>
          </ng-template>

          <!-- EDIT mode template -->
          <ng-template #elseEditing>
            <div *ngIf="todoLabelFormControl" class="input-group">
              <div class="d-flex align-items-center flex-grow-1">
                <input [id]="'todo'+ idx" class="form-check-input me-2"
                       type="checkbox">
                <input #inputEdit
                       (blur)="onValidEditExit()"
                       (keydown.escape)="onCancelEditExit()"
                       (keyup.enter)="onValidEditExit()"
                       [formControl]="todoLabelFormControl"
                       class="form-control border-0 bg-whitline-through"
                       data-test="input-edit"
                />
              </div>
            </div>
          </ng-template>

        </li>
      </ul>
    </div>
    <!-- List content -->

  </div>
</div>

<div class="card custom-card">
  <div class="card-body  custom-padding" data-test="remaining-message">
    {{ todos | remainingMessage}}
  </div>
</div>
